<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU"
            crossorigin="anonymous"
        />
        <link
            rel="stylesheet"
            href="fontawesome-free-6.1.1-web/fontawesome-free-6.1.1-web/css/all.css"
        />
        <title>Document</title>
        <style>
            .pic > img {
                width: 50px;
            }
            .wrap {
                line-height: 50px;
            }

            .fa-trash-can:hover {
                color: #faa;
            }
            td > a {
                color: #333;
            }
            .btn {
                padding: 0;
            }
            .btn > a {
                text-decoration: none;
                color: green;
                display: inline-block;
                padding: 6px 12px;
            }
            .btn:hover > a {
                color: #fff;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <button type="button" class="btn btn-outline-success">
                <a href="./add-data.html"> 新增課程</a>
            </button>
            <table class="table">
                <thead>
                    <tr>
                        <th scope="col">課程編號</th>
                        <th scope="col">課程照片</th>
                        <th scope="col">課程名稱</th>
                        <th scope="col">課程難度</th>
                        <th scope="col">課程價格</th>
                        <th scope="col">修改</th>
                        <th scope="col">刪除</th>
                    </tr>
                </thead>
                <tbody class="wrap">
                    <!-- <tr>
                        <td scope="row" class="pic">
                            <img src="images/heart.png" alt="" />
                        </td>
                        <td>Mark</td>
                        <td>Otto</td>
                        <td>NT$</td>
                        <td><i class="fa-solid fa-trash-can"></i></td>
                    </tr> -->
                </tbody>
            </table>
            <!-- <div class="row">
                <div class="col">
                    <nav aria-label="Page navigation example">
                        <ul class="pagination justify-content-center">
                            <li class="page-item">
                                <a
                                    class="page-link"
                                    href="#"
                                    aria-label="Previous"
                                >
                                    <span aria-hidden="true">&laquo;</span>
                                </a>
                            </li>

                            <a class="page-link" href="#">1</a>

                            <a class="page-link" href="#">2</a>

                            <a class="page-link" href="#">3</a>

                            <li class="page-item">
                                <a class="page-link" href="#" aria-label="Next">
                                    <span aria-hidden="true">&raquo;</span>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div> -->
        </div>
        <script>
            const wrap = document.querySelector(".wrap");
            const classIndexApi =
                "http://localhost/coffee-course/class-index-api.php";
            const deleteApi = "http://localhost/coffee-course/delete-api.php";

            // 資料/畫面生成
            function getData() {
                // 換頁功能(未完成)
                const fd = new FormData();
                fd.append("page", 1);

                fetch(classIndexApi, {
                    method: "POST",
                    body: fd,
                })
                    .then((response) => {
                        // console.log(response);
                        return response.json();
                    })
                    .then((data) => {
                        console.log(data.rows);
                        for (let i = 0; i < data.length; i++) {
                            const trs = document.createElement("tr");
                            wrap.appendChild(trs);

                            trs.innerHTML = `
                            <td>${data[i].course_sid}</td>
                             <td scope="row" class="pic">
                            <img src="./uploaded/${data[i].course_img_s}" alt="" />
                        </td>
                        <td>${data[i].course_name}</td>
                        <td class="course_level">${data[i].course_level}</td>
                        <td>NT$${data[i].course_price}</td>
                        <td><a href="./edit-data.html?${data[i].course_sid}"><i class="fa-solid fa-pen-to-square"></i></a></td>
                        <td><a href=""><i class="fa-solid fa-trash-can" onclick="deleteData(${data[i].course_sid})"></i></a></td>`;
                            // console.log(data[i].course_sid);
                            courseLevel =
                                document.querySelectorAll(".course_level");
                            if (data[i].course_level === "1") {
                                courseLevel[i].innerHTML = "入門";
                            }
                            if (data[i].course_level === "2") {
                                courseLevel[i].innerHTML = "中級";
                            }
                            if (data[i].course_level === "3") {
                                courseLevel[i].innerHTML = "高級";
                            }
                        }
                    });
            }
            getData();

            // 資料刪除
            function deleteData(value) {
                const fd = new FormData();
                fd.append("course_sid", value);
                confirm("確定要刪除第" + value + "筆資料嗎?")
                    ? fetch(deleteApi, {
                          method: "POST",
                          body: fd,
                      }).then(() => {
                          wrap.innerHTML = "";
                          getData();
                      })
                    : 0;
            }
        </script>
    </body>
</html>
